<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh s√°ch S·∫£n ph·∫©m (API)</title>
    <style>
        :root {
            --bg: #faf5ef;
            --surface: #ffffff;
            --primary: #08203a;
            --accent: #ff6b81;
            --muted: #6b7280;
            --card-radius: 12px;
            --shadow: 0 4px 10px rgba(8,32,58,0.08);
            --font: Arial, sans-serif;
        }

        body {
            font-family: var(--font);
            margin: 20px;
            background-color: var(--bg);
            color: var(--primary);
        }

        /* Thanh c√¥ng c·ª• */
        .toolbar {
            background-color: var(--surface);
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex; flex-wrap: wrap; gap: 15px; align-items: center;
        }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .control-group label { font-weight: 600; color: var(--primary); }
        input, select {
            padding: 8px; border: 1px solid #e6e6e6; border-radius: 6px; min-width: 150px; background: #fff; color: var(--primary);
        }
        input:focus, select:focus { outline: 2px solid rgba(255,107,129,0.12); }

        /* B·∫£ng d·ªØ li·ªáu */
        table { width: 100%; border-collapse: collapse; background: transparent; }
        th, td { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; text-align: left; vertical-align: middle; }
        th { background-color: transparent; color: var(--primary); text-transform: uppercase; font-size: 0.9em; font-weight: 700; }
        thead tr { border-bottom: 2px solid rgba(8,32,58,0.06); }

        /* Zebra nh·∫π */
        tbody tr:nth-child(odd) { background-color: var(--surface); color: var(--primary); }
        tbody tr:nth-child(even) { background-color: rgba(8,32,58,0.03); color: var(--primary); }

        .product-img { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid #eee; background: #fff; }

        /* Ph√¢n trang */
        .pagination { margin-top: 20px; display: flex; justify-content: center; gap: 8px; }
        .pagination button { padding: 8px 12px; border: 1px solid #e6e6e6; background-color: var(--surface); cursor: pointer; border-radius: 6px; color: var(--primary); }
        .pagination button.active { background: var(--primary); color: white; font-weight: 700; border-color: var(--primary); }
        .pagination button:disabled { background: #f5f5f5; cursor: not-allowed; color: var(--muted); }

        /* Hi·ªáu ·ª©ng n√∫t */
        button { transition: all .18s ease; }
        button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 6px 14px rgba(8,32,58,0.06); }

        @media (max-width:600px) {
            .toolbar { flex-direction: column; align-items: stretch; }
            .control-group { width: 100%; }
        }
    </style>
</head>
<body>

    <div class="toolbar">
        <div class="control-group">
            <label>üîç T√¨m t√™n s·∫£n ph·∫©m:</label>
            <input type="text" placeholder="Nh·∫≠p t√™n..." oninput="handleSearch(this.value)">
        </div>
        <div class="control-group">
            <label>üîÉ S·∫Øp x·∫øp:</label>
            <select onchange="handleSort(this.value)">
                <option value="">-- M·∫∑c ƒë·ªãnh --</option>
                <option value="price-asc">üí∞ Gi√°: Th·∫•p -> Cao</option>
                <option value="price-desc">üí∞ Gi√°: Cao -> Th·∫•p</option>
                <option value="title-asc">üÖ∞Ô∏è T√™n: A -> Z</option>
                <option value="title-desc">üÖ∞Ô∏è T√™n: Z -> A</option>
            </select>
        </div>
        <div class="control-group">
            <label>üìÑ S·ªë d√≤ng/trang:</label>
            <select onchange="handlePageSize(this.value)">
                <option value="5">5 d√≤ng</option>
<option value="10">10 d√≤ng</option>
                <option value="20">20 d√≤ng</option>
            </select>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th style="width: 80px;">·∫¢nh</th>
                <th>T√™n s·∫£n ph·∫©m</th>
                <th style="width: 150px;">Gi√° ($)</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr><td colspan="4" style="text-align:center;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
        </tbody>
    </table>
    <div class="pagination" id="pagination"></div>

    <script>
        const API_URL = 'https://api.escuelajs.co/api/v1/products';
        let originalData = []; // D·ªØ li·ªáu g·ªëc
        let filteredData = []; // D·ªØ li·ªáu ƒëang hi·ªÉn th·ªã (sau khi l·ªçc/sort)
        
        let state = { page: 1, limit: 5, search: '', sortBy: '' };

        // 1. T·∫£i d·ªØ li·ªáu t·ª´ API
        async function init() {
            try {
                let res = await fetch(API_URL);
                originalData = await res.json();
                filteredData = [...originalData];
                renderTable();
            } catch (e) {
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="4">L·ªói t·∫£i d·ªØ li·ªáu</td></tr>`;
                console.error(e);
            }
        }

        // 2. X·ª≠ l√Ω logic (L·ªçc -> S·∫Øp x·∫øp -> C·∫Øt trang)
        function processData() {
            // L·ªçc
            let result = originalData.filter(item => item.title.toLowerCase().includes(state.search.toLowerCase()));

            // S·∫Øp x·∫øp
            if (state.sortBy) {
                result.sort((a, b) => {
                    let [field, order] = state.sortBy.split('-');
                    if (field === 'price') return order === 'asc' ? a.price - b.price : b.price - a.price;
                    if (field === 'title') return order === 'asc' ? a.title.localeCompare(b.title) : b.title.localeCompare(a.title);
                });
            }
            
            filteredData = result;
            // Reset v·ªÅ trang 1 n·∫øu t√¨m ki·∫øm ho·∫∑c ƒë·ªïi s·ªë l∆∞·ª£ng d√≤ng
            let maxPage = Math.ceil(filteredData.length / state.limit) || 1;
            if (state.page > maxPage) state.page = 1;
        }

        // 3. Hi·ªÉn th·ªã ra m√†n h√¨nh
        function renderTable() {
            processData();
            let tbody = document.getElementById('tableBody');
            let start = (state.page - 1) * state.limit;
            let pageData = filteredData.slice(start, start + state.limit);

            tbody.innerHTML = '';
            if (pageData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
                return;
            }

            pageData.forEach(item => {
                // L·∫•y ·∫£nh ƒë·∫ßu ti√™n, x·ª≠ l√Ω ch√∫t ƒë·ªÉ tr√°nh l·ªói ·∫£nh
let img = (item.images && item.images.length > 0) ? item.images[0] : '';
                // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p API tr·∫£ v·ªÅ chu·ªói JSON stringify b·ªã l·ªói (ƒë·∫∑c th√π c·ªßa API n√†y)
                if(img.startsWith('["')) {
                    try { img = JSON.parse(img)[0]; } catch(e){}
                }
                
                tbody.innerHTML += `
                    <tr>
                        <td>${item.id}</td>
                        <td><img src="${img}" class="product-img" onerror="this.src='https://via.placeholder.com/60'"></td>
                        <td>${item.title}</td>
                        <td><b>$${item.price}</b></td>
                    </tr>
                `;
            });
            renderPagination();
        }

        // 4. V·∫Ω n√∫t ph√¢n trang
        function renderPagination() {
            let div = document.getElementById('pagination');
            let totalPages = Math.ceil(filteredData.length / state.limit);
            let html = '';

            if (totalPages > 1) {
                html += `<button onclick="changePage(${state.page - 1})" ${state.page===1?'disabled':''}>¬´</button>`;
                
                // Logic v·∫Ω n√∫t g·ªçn g√†ng
                let start = Math.max(1, state.page - 2);
                let end = Math.min(totalPages, state.page + 2);
                
                if (start > 1) html += `<button onclick="changePage(1)">1</button><span>...</span>`;
                for (let i = start; i <= end; i++) {
                    html += `<button onclick="changePage(${i})" class="${i===state.page?'active':''}">${i}</button>`;
                }
                if (end < totalPages) html += `<span>...</span><button onclick="changePage(${totalPages})">${totalPages}</button>`;
                
                html += `<button onclick="changePage(${state.page + 1})" ${state.page===totalPages?'disabled':''}>¬ª</button>`;
            }
            div.innerHTML = html;
        }

        // 5. C√°c h√†m s·ª± ki·ªán
        function handleSearch(val) { state.search = val; state.page = 1; renderTable(); }
        function handleSort(val) { state.sortBy = val; renderTable(); }
        function handlePageSize(val) { state.limit = Number(val); state.page = 1; renderTable(); }
        function changePage(page) { state.page = page; renderTable(); }

        init(); // Ch·∫°y ·ª©ng d·ª•ng
    </script>
</body>
</html>